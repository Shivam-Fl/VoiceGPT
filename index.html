<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VoiceGPT</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
</head>

<body class="bg-gray-600 h-[100vh]">
   <nav class="bg-gray-900 w-full p-4">
    <h1 class="text-5xl font-bold text-gray-100">VoiceGPT</h1>
   </nav>
    <main >
        <div class="container-fluid my-4 bg-primary chats">
           
        </div>
        <div class="absolute bottom-4 h-16 w-[100vw] flex  ">
            <input id="prompt" class="basis-2/3 bg-gray-600 border rounded-3xl border-gray-900 mx-10 shadow" type="text">
            <div class="basis-1/3 h-16"> <button id="start" type="button" class="bg-gray-900 text-gray-100 text-3xl  p-4 rounded-3xl border ">Start</button>
                <button id="voiceInput" type="button" class="bg-gray-900 text-gray-100 text-3xl  p-4 rounded-3xl border ">Voice</button><button id="stop" type="button" class="bg-gray-900 text-gray-100 text-3xl  p-4 rounded-3xl border ">Stop</button>
            </div>
            
        </div>
       
    </main>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
        crossorigin="anonymous"></script>
    <script>
        async function postData(url = "", data = {}) {
            // Default options are marked with *
            const response = await fetch(url, {
                method: "POST", // *GET, POST, PUT, DELETE, etc.
                mode: "cors", // no-cors, *cors, same-origin
                cache: "no-cache", // *default, no-cache, reload, force-cache, only-if-cached
                credentials: "same-origin", // include, *same-origin, omit
                headers: {
                    "Content-Type": "application/json",
                    // 'Content-Type': 'application/x-www-form-urlencoded',
                },
                redirect: "follow", // manual, *follow, error
                referrerPolicy: "no-referrer", // no-referrer, *no-referrer-when-downgrade, origin, origin-when-cross-origin, same-origin, strict-origin, strict-origin-when-cross-origin, unsafe-url
                body: JSON.stringify(data), // body data type must match "Content-Type" header
            });
            return response.json(); // parses JSON response into native JavaScript objects
        }

        let recognition; // Declare recognition outside the event listener

        // Function to start voice recognition
        function startVoiceRecognition() {
            const inputField = document.getElementById("prompt");
            const outputDiv = document.querySelector(".chats");

            // Check if the browser supports the Web Speech API
            if ('webkitSpeechRecognition' in window) {
                if (!recognition) {
                    recognition = new webkitSpeechRecognition();

                    // Set properties for the recognition
                    recognition.continuous = false; // Stop recognition after a single phrase
                    recognition.interimResults = false; // Get final results only

                    // Event handler when speech recognition results are received
                    recognition.onresult = (event) => {
                        const result = event.results[0];
                        const transcript = result[0].transcript;
                        inputField.value = transcript;

                        // Send the recognized text to the server
                        postData("/api", { input: transcript }).then((data) => {
                            console.log(data.message); // JSON data parsed by `data.json()` call
                            outputDiv.innerHTML += `<p>
                                <li>
                                    ${transcript} <br>
                                    Ans: ${data.message}
                                </li>
                            </p>`;
                        });
                    };

                    // Event handler when speech recognition ends
                    recognition.onend = () => {
                        console.log("Speech recognition ended.");
                    };
                }

                // Start voice recognition
                recognition.start();
            } else {
                console.log("Speech recognition not supported in this browser.");
            }
        }

        // Event listener for the "Voice Input" button
        document.getElementById("voiceInput").addEventListener("click", () => {
            startVoiceRecognition();
        });

        // Event listener for the "Start" button (for typed input)
        document.getElementById("start").addEventListener("click", () => {
            const inputField = document.getElementById("prompt");
            const outputDiv = document.querySelector(".chats");
            const input = inputField.value;

            // Send the typed input to the server
            postData("/api", { input }).then((data) => {
                console.log(data.message); // JSON data parsed by `data.json()` call
                outputDiv.innerHTML += `<p>
                    <li>
                        ${input} <br>
                        Ans: ${data.message}
                    </li>
                </p>`;
            });
        });

        // Event listener for the "Stop" button
        document.getElementById("stop").addEventListener("click", () => {
            if (recognition && recognition.running) {
                recognition.stop();
            }
        });

    </script>
</body>

</html>
